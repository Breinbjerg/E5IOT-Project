TCPClient client;

bool over = false;

void setup()
{
    // Make sure your Serial Terminal app is closed before powering your device
    Serial.begin(115200);
    // Now open your Serial Terminal, and hit any key to continue!
    while(!Serial.available()) SPARK_WLAN_Loop();
    String path = "%7C56.0960,8.6104%7C56.0960,8.6102%7C56.0960,8.6103%7C56.0958,8.6108%7C56.0959,8.6110%7C56.0960,8.6113%7C56.0960,8.6116%7C56.0961,8.6119%7C56.0961,8.6121%7C56.0961,8.6121%7C56.0961,8.6122%7C56.0962,8.6123%7C56.0963,8.6123%7C56.0965,8.6124%7C56.0966,8.6125%7C56.0968,8.6125%7C56.0968,8.6124%7C56.0970,8.6122%7C56.0971,8.6120%7C56.0972,8.6118%7C56.0972,8.6116%7C56.0974,8.6114%7C56.0975,8.6113%7C56.0976,8.6111%7C56.0978,8.6108%7C56.0978,8.6106%7C56.0978,8.6104%7C56.0978,8.6102%7C56.0978,8.6100%7C56.0978,8.6097%7C56.0977,8.6094%7C56.0976,8.6091%7C56.0975,8.6089%7C56.0974,8.6087%7C56.0973,8.6086%7C56.0972,8.6084%7C56.0972,8.6082%7C56.0971,8.6081%7C56.0970,8.6078%7C56.0970,8.6076%7C56.0969,8.6073%7C56.0968,8.6071%7C56.0966,8.6069%7C56.0965,8.6067%7C56.0965,8.6065%7C56.0964,8.6061%7C56.0963,8.6058%7C56.0962,8.6055%7C56.0961,8.6053%7C56.0960,8.6050%7C56.0959,8.6048%7C56.0958,8.6046%7C56.0957,8.6044%7C56.0955,8.6042%7C56.0954,8.6041%7C56.0953,8.6039%7C56.0953,8.6036%7C56.0952,8.6033%7C56.0950,8.6031%7C56.0950,8.6034%7C56.0950,8.6036%7C56.0948,8.6039%7C56.0947,8.6040%7C56.0946,8.6042%7C56.0945,8.6044%7C56.0944,8.6046%7C56.0943,8.6047%7C56.0942,8.6049%7C56.0941,8.6051%7C56.0939,8.6053%7C56.0938,8.6055%7C56.0937,8.6057%7C56.0936,8.6059%7C56.0935,8.6061%7C56.0934,8.6062%7C56.0932,8.6064%7C56.0931,8.6066%7C56.0929,8.6069%7C56.0928,8.6070%7C56.0927,8.6072%7C56.0925,8.6073%7C56.0924,8.6074%7C56.0922,8.6076%7C56.0921,8.6077%7C56.0919,8.6077%7C56.0918,8.6078%7C56.0917,8.6079%7C56.0915,8.6079%7C56.0914,8.6079%7C56.0912,8.6080%7C56.0910,8.6079%7C56.0910,8.6080%7C56.0910,8.6082%7C56.0910,8.6085%7C56.0911,8.6087%7C56.0911,8.6089%7C56.0912,8.6091%7C56.0912,8.6094%7C56.0912,8.6097%7C56.0911,8.6100%7C56.0911,8.6103%7C56.0911,8.6107%7C56.0911,8.6110%7C56.0912,8.6112%7C56.0912,8.6114%7C56.0913,8.6117%7C56.0913,8.6119%7C56.0913,8.6121%7C56.0913,8.6125%7C56.0912,8.6129%7C56.0912,8.6133%7C56.0912,8.6135%7C56.0912,8.6138%7C56.0913,8.6138%7C56.0914,8.6139%7C56.0914,8.6141%7C56.0915,8.6143%7C56.0916,8.6145%7C56.0918,8.6147%7C56.0920,8.6148%7C56.0922,8.6148%7C56.0923,8.6149%7C56.0924,8.6148%7C56.0926,8.6147%7C56.0927,8.6146%7C56.0928,8.6144%7C56.0929,8.6143%7C56.0931,8.6142%7C56.0932,8.6141%7C56.0933,8.6140%7C56.0935,8.6140%7C56.0936,8.6140%7C56.0938,8.6139%7C56.0939,8.6139%7C56.0941,8.6139%7C56.0942,8.6138%7C56.0944,8.6137%7C56.0945,8.6137%7C56.0946,8.6136%7C56.0948,8.6135%7C56.0949,8.6134%7C56.0950,8.6133%7C56.0951,8.6132%7C56.0953,8.6131%7C56.0954,8.6130%7C56.0955,8.6129%7C56.0956,8.6129%7C56.0958,8.6128%7C56.0959,8.6126%7C56.0960,8.6123%7C56.0961,8.6122%7C56.0962,8.6123%7C56.0962,8.6121%7C56.0961,8.6119%7C56.0961,8.6116%7C56.0960,8.6113%7C56.0960,8.6111%7C56.0960,8.6109%7C56.0960,8.6109%7C56.0961,8.6108%7C56.0961,8.6107%7C56.0962,8.6107%7C56.0962,8.6107%7C56.0961,8.6107";
    Serial.println("connecting... ");
    
    if (client.connect("smtp.mailgun.org", 587)) 
    { 
        Serial.println("connected"); 
        //client.println("EHLO 185.182.204.219");
       // client.println("STARTTLS");
        client.println("EHLO 185.182.204.219");
        client.println("AUTH PLAIN");
        client.println("*************");
        client.println("MAIL FROM:<particle@sandbox74891f94361d48bf8fa4f94ebb06d09e.mailgun.org>");
        client.println("RCPT TO:<thomas.serup80@gmail.com>");
        client.println("DATA");  
        client.println("From: Trackster <particle@sandbox74891f94361d48bf8fa4f94ebb06d09e.mailgun.org>");
        client.println("Subject: Your route");
        client.println("To: Thomas <thomas.serup80@gmail.com>");
        client.println();
        client.println("https://maps.googleapis.com/maps/api/staticmap?size=600x400&path=color:0xff0000ff|weight:5" + path + "&key=AIzaSyC3WoXkULYQTKwO3bRNlboEQAVWnP80aRM");
        client.println(".");
        client.println("QUIT"); 
    }
    else
    {
        Serial.println("connection failed");
    }
}
void loop()
{
    if(over == false)
    {
        if (client.available())
        {
            char c = client.read();
            Serial.print(c);
        }
        
        if (!client.connected())
        {
            Serial.println();
            Serial.println("disconnecting.");
            client.stop();
            over = true;
        }
    }
}